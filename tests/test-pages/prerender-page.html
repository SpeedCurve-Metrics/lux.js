<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LUX prerender test page</title>
    <script>/*INJECT_SCRIPT*/</script>
    <script src="/js/lux.js?id=10001" async crossorigin="anonymous" onload="log('lux.js loaded')"></script>
</head>
<body>
    <h1>LUX prerender test page</h1>
    <p>This page can be prerendered from <a href="/prerender-index.html">the prerender test index page</a>.</p>
    <ul id="log"></ul>

    <script>
    const logVisibilityState = () => log(`visibilityState = ${document.visibilityState}`);
    const logPrerenderingState = () => log(`prerendering = ${document.prerendering}`);

    logPrerenderingState();
    logVisibilityState();

    const prerenderInterval = setInterval(() => {
        logPrerenderingState();

        if (!document.prerendering) {
            clearInterval(prerenderInterval);
        }
    }, 1000);

    ["pageshow", "load", "DOMContentLoaded"].forEach((eventName) => {
        addEventListener(eventName, () => log(eventName));
    });

    addEventListener("visibilitychange", logVisibilityState);

    document.addEventListener("prerenderingchange", () => {
        clearInterval(prerenderInterval);
        logPrerenderingState();
    });

    function log(message) {
        const li = document.createElement("li");
        li.textContent = `[${performance.now().toFixed(0)} ms] ${message}`;
        document.getElementById("log").appendChild(li);
    }
    </script>
</body>
</html>
